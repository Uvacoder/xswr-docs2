# Optimistic updates

When updating a resource (e.g. via POST, PUT or DELETE), xswr can pre-display the result before the fetcher response.

If the fetcher throws an error, xswr will rollback the resource to the previous state.

### Usage

This feature is only available for single resources, using `handle.update(previous => data)`.

You have to implement the actual update by using the extra `data` parameter in your fetcher.

You can, for example, do a `POST` request when the extra `data` parameter is passed, and `GET` otherwise.

Optimistic updates are fully abortables like any other request, using `handle.aborter`.

You can tell wether some state is optimistic by checking `handle.optimistic` (boolean).

### Example 

```tsx
async function postAsJson<T>(url: string, more: XSWR.PosterMore<T>) {
  const { data, signal } = more

  const method = data ? "POST" : "GET"
  const body = data ? JSON.stringify(data) : undefined

  const res = await fetch(url, { method, body, signal })
  if (!res.ok) throw new Error()

  const data = await res.json() as T
  return { data }
}

function getHelloSchema() {
  return XSWR.single<Hello>("/api/hello", fetchAsJson, { cooldown: 5000 })
}

function useHelloMix() {
  const handle = XSWR.use(getHelloSchema, [])
  useAutoFetchMixture(handle)
  return handle
}

export function MyApp() {
  const mydata = useMyData()

  const onUpdateClick = useCallback(() => {
    mydata.update(() => ({ name: "John Doe" }))
  }, [mydata.update])

  return <>
    <div>
      {JSON.stringify(mydata.data)}
    </div>
    <button onClick={onUpdateClick}>
      Update
    </button>
  </>
}
```